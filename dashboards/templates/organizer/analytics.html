<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - EventHub</title>
</head>
<body style="margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f7fafc; min-height: 100vh;">

    <!-- Sidebar -->
    {% include 'org_lhn.html' %}

    <!-- Main Content -->
    <div style="margin-left: 260px; padding: 40px;">

        <!-- Page Header -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 35px;">
            <div>
                <h1 style="margin: 0 0 8px; color: #2d3748; font-size: 32px; font-weight: 700;">Analytics</h1>
                <p style="margin: 0; color: #718096; font-size: 15px;">Track performance across all your events</p>
            </div>
            <div style="display: flex; gap: 12px;">
                <select style="padding: 12px 18px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px; color: #4a5568; outline: none; cursor: pointer; background: white; font-weight: 500;">
                    <option>Last 30 Days</option>
                    <option>Last 7 Days</option>
                    <option>Last 3 Months</option>
                    <option>Last Year</option>
                    <option>All Time</option>
                </select>
                <select style="padding: 12px 18px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px; color: #4a5568; outline: none; cursor: pointer; background: white; font-weight: 500;">
                    <option>All Events</option>
                    {% for event in events %}
                    <option value="{{ event.pk }}">{{ event.title }}</option>
                    {% endfor %}
                </select>
                <button style="padding: 12px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 15px rgba(102,126,234,0.4);">
                    <span>üì•</span> Export Report
                </button>
            </div>
        </div>

        <!-- KPI Stats Cards -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; margin-bottom: 35px;">
            
            <div style="background: white; border-radius: 16px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; position: relative; overflow: hidden;">
                <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(102,126,234,0.1); border-radius: 50%;"></div>
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px;">üìÖ</div>
                    <span style="background: #d1fae5; color: #065f46; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">{{ total_events_growth }}%</span>
                </div>
                <h3 style="margin: 0 0 5px; color: #2d3748; font-size: 30px; font-weight: 700;">{{ total_events }}</h3>
                <p style="margin: 0; color: #718096; font-size: 14px; font-weight: 500;">Total Events</p>
            </div>

            <div style="background: white; border-radius: 16px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; position: relative; overflow: hidden;">
                <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(240,147,251,0.1); border-radius: 50%;"></div>
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px;">üéüÔ∏è</div>
                    <span style="background: #d1fae5; color: #065f46; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">{{ total_attendees_growth }}%</span>
                </div>
                <h3 style="margin: 0 0 5px; color: #2d3748; font-size: 30px; font-weight: 700;">{{ total_attendees }}</h3>
                <p style="margin: 0; color: #718096; font-size: 14px; font-weight: 500;">Total Attendees</p>
            </div>

            <div style="background: white; border-radius: 16px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; position: relative; overflow: hidden;">
                <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(79,172,254,0.1); border-radius: 50%;"></div>
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px;">üíµ</div>
                    <span style="background: #d1fae5; color: #065f46; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">{{ revenue_growth }}%</span>
                </div>
                <h3 style="margin: 0 0 5px; color: #2d3748; font-size: 30px; font-weight: 700;">Rs. {{ total_revenue }}</h3>
                <p style="margin: 0; color: #718096; font-size: 14px; font-weight: 500;">Total Revenue</p>
            </div>

            <div style="background: white; border-radius: 16px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; position: relative; overflow: hidden;">
                <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: rgba(247,112,154,0.1); border-radius: 50%;"></div>
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                    <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px;">‚≠ê</div>
                    <span style="background: #fef3c7; color: #92400e; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600;">{{ rating_change }}%</span>
                </div>
                <h3 style="margin: 0 0 5px; color: #2d3748; font-size: 30px; font-weight: 700;">{{ avg_rating }}</h3>
                <p style="margin: 0; color: #718096; font-size: 14px; font-weight: 500;">Avg. Rating</p>
            </div>
        </div>

        <!-- Charts Row -->
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px; margin-bottom: 30px;">

            <!-- Attendees Over Time Chart -->
            <div style="background: white; border-radius: 16px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <div>
                        <h2 style="margin: 0 0 5px; color: #2d3748; font-size: 20px; font-weight: 700;">Attendance Overview</h2>
                        <p style="margin: 0; color: #718096; font-size: 13px;">Monthly attendee registrations</p>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <span style="display: flex; align-items: center; gap: 5px; color: #718096; font-size: 13px;"><span style="width: 12px; height: 12px; background: #667eea; border-radius: 3px; display: inline-block;"></span>Registrations</span>
                        <span style="display: flex; align-items: center; gap: 5px; color: #718096; font-size: 13px; margin-left: 8px;"><span style="width: 12px; height: 12px; background: #10b981; border-radius: 3px; display: inline-block;"></span>Check-ins</span>
                    </div>
                </div>
                <!-- Chart Bars - will be driven by backend data -->
                <div style="display: flex; align-items: flex-end; gap: 12px; height: 200px; padding: 0 10px;">
                    {% for month in monthly_data %}
                    <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 5px; height: 100%;">
                        <div style="width: 100%; display: flex; gap: 4px; align-items: flex-end; height: 160px;">
                            <div style="flex: 1; background: linear-gradient(to top, #667eea, #764ba2); border-radius: 4px 4px 0 0; height: {{ month.registrations_pct }}%;"></div>
                            <div style="flex: 1; background: linear-gradient(to top, #10b981, #34d399); border-radius: 4px 4px 0 0; height: {{ month.checkins_pct }}%;"></div>
                        </div>
                        <span style="color: #94a3b8; font-size: 11px; font-weight: 600;">{{ month.label }}</span>
                    </div>
                    {% endfor %}    
                </div>
            </div>

            <!-- Revenue Breakdown -->
            <div style="background: white; border-radius: 16px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                <h2 style="margin: 0 0 5px; color: #2d3748; font-size: 20px; font-weight: 700;">Revenue Breakdown</h2>
                <p style="margin: 0 0 25px; color: #718096; font-size: 13px;">By event category</p>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    {% for cat in revenue_by_category %}
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                            <span style="color: #2d3748; font-size: 13px; font-weight: 600;">{{ cat.name }}</span>
                            <span style="color: #667eea; font-size: 13px; font-weight: 700;">Rs. {{ cat.revenue }}</span>
                        </div>
                        <div style="background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <!-- <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100%; width: {{ cat.percentage }}%; border-radius: 4px;"></div> -->
                        </div>
                    </div>
                    {% endfor %}
                    <!-- Empty state -->
                    {% if not revenue_by_category %}
                    <div style="text-align: center; padding: 40px 15px;">
                        <p style="margin: 0; color: #718096; font-size: 13px;">No revenue data yet</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Second Row -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px;">
            
            <!-- Top Events Table -->
            <div style="background: white; border-radius: 16px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: #2d3748; font-size: 20px; font-weight: 700;">Top Performing Events</h2>
                    <a href="#" style="color: #667eea; text-decoration: none; font-size: 13px; font-weight: 600;">View All ‚Üí</a>
                </div>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    {% for event in top_events %}
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f8fafc; border-radius: 10px; border: 1px solid #e2e8f0;">
                        <div style="flex-shrink: 0; width: 45px; height: 45px; border-radius: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px;">{{ forloop.counter }}</div>
                        <div style="flex: 1; min-width: 0;">
                            <p style="margin: 0 0 3px; color: #2d3748; font-weight: 600; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ event.title }}</p>
                            <p style="margin: 0; color: #718096; font-size: 12px;">{{ event.attendees_count }} attendees</p>
                        </div>
                        <div style="text-align: right; flex-shrink: 0;">
                            <p style="margin: 0 0 3px; color: #2d3748; font-weight: 700; font-size: 14px;">Rs. {{ event.revenue }}</p>
                            <p style="margin: 0; color: #10b981; font-size: 12px; font-weight: 600;">{{ event.occupancy }}% full</p>
                        </div>
                    </div>
                    {% empty %}
                    <div style="text-align: center; padding: 40px 15px; border: 2px dashed #cbd5e0; border-radius: 10px;">
                        <p style="margin: 0; color: #718096; font-size: 13px;">No event data yet</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Attendee Demographics -->
            <div style="background: white; border-radius: 16px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                <h2 style="margin: 0 0 5px; color: #2d3748; font-size: 20px; font-weight: 700;">Registration Insights</h2>
                <p style="margin: 0 0 25px; color: #718096; font-size: 13px;">Ticket types and registration trends</p>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    
                    <!-- Ticket Type Breakdown -->
                    {% for ticket_type in ticket_types %}
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 14px; background: #f8fafc; border-radius: 10px; border: 1px solid #e2e8f0;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <!-- <div style="width: 12px; height: 12px; border-radius: 50%; background: {{ ticket_type.color }};"></div> -->
                            <span style="color: #2d3748; font-size: 14px; font-weight: 600;">{{ ticket_type.name }}</span>
                        </div>
                        <div style="text-align: right;">
                            <span style="color: #2d3748; font-size: 14px; font-weight: 700;">{{ ticket_type.count }}</span>
                            <span style="color: #718096; font-size: 12px; margin-left: 6px;">({{ ticket_type.percentage }}%)</span>
                        </div>
                    </div>
                    {% empty %}
                    <div style="text-align: center; padding: 40px 15px; border: 2px dashed #cbd5e0; border-radius: 10px;">
                        <p style="margin: 0; color: #718096; font-size: 13px;">No registration data yet</p>
                    </div>
                    {% endfor %}
                    
                    <!-- Registration Rate -->
                    <div style="margin-top: 10px; padding: 15px; background: linear-gradient(135deg, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0.1) 100%); border-radius: 10px; border: 1px solid rgba(102,126,234,0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #2d3748; font-size: 14px; font-weight: 600;">Overall Occupancy Rate</span>
                            <span style="color: #667eea; font-size: 16px; font-weight: 700;">{{ overall_occupancy }}%</span>
                        </div>
                        <div style="background: #e2e8f0; height: 10px; border-radius: 5px; overflow: hidden;">
                            <!-- <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100%; width: {{ overall_occupancy }}%; border-radius: 5px;"></div> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Registrations Table -->
        <div style="background: white; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; overflow: hidden;">
            <div style="padding: 25px 30px; border-bottom: 2px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; color: #2d3748; font-size: 20px; font-weight: 700;">Recent Registrations</h2>
                <a href="#" style="color: #667eea; text-decoration: none; font-size: 14px; font-weight: 600;">View All ‚Üí</a>
            </div>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f8fafc;">
                            <th style="padding: 14px 30px; text-align: left; color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Attendee</th>
                            <th style="padding: 14px 30px; text-align: left; color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Event</th>
                            <th style="padding: 14px 30px; text-align: left; color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Ticket</th>
                            <th style="padding: 14px 30px; text-align: left; color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Date</th>
                            <th style="padding: 14px 30px; text-align: left; color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Amount</th>
                            <th style="padding: 14px 30px; text-align: left; color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for reg in recent_registrations %}
                        <tr style="border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 18px 30px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 13px; flex-shrink: 0;">{{ reg.user.name|slice:":1" }}</div>
                                    <div>
                                        <p style="margin: 0 0 2px; color: #2d3748; font-weight: 600; font-size: 14px;">{{ reg.user.name }}</p>
                                        <p style="margin: 0; color: #718096; font-size: 12px;">{{ reg.user.email }}</p>
                                    </div>
                                </div>
                            </td>
                            <td style="padding: 18px 30px;">
                                <p style="margin: 0; color: #2d3748; font-size: 14px; font-weight: 500; max-width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ reg.event.title }}</p>
                            </td>
                            <td style="padding: 18px 30px;">
                                <span style="background: #edf2f7; color: #667eea; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: 600;">{{ reg.ticket_type }}</span>
                            </td>
                            <td style="padding: 18px 30px;">
                                <p style="margin: 0; color: #475569; font-size: 14px;">{{ reg.created_at|date:"M d, Y" }}</p>
                            </td>
                            <td style="padding: 18px 30px;">
                                <p style="margin: 0; color: #2d3748; font-size: 14px; font-weight: 600;">Rs. {{ reg.amount }}</p>
                            </td>
                            <td style="padding: 18px 30px;">
                                {% if reg.status == 'confirmed' %}
                                <span style="background: #d1fae5; color: #065f46; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">‚úì Confirmed</span>
                                {% elif reg.status == 'pending' %}
                                <span style="background: #fef3c7; color: #92400e; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">‚è≥ Pending</span>
                                {% else %}
                                <span style="background: #fee2e2; color: #991b1b; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">‚úï Cancelled</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" style="padding: 60px 30px; text-align: center;">
                                <div style="font-size: 48px; margin-bottom: 12px;">üìä</div>
                                <p style="margin: 0; color: #718096; font-size: 15px;">No registrations yet</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</body>
</html>